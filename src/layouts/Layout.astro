---
import { ViewTransitions } from 'astro:transitions';
import Navbar from '../components/Navbar.astro';
import PwaComponent from '../components/PwaComponent.astro';
import '../styles/global.css';
---
<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/webp" href="/favicon.webp" />
    <link rel="apple-touch-icon" href="/icons/icon192.webp">
		<meta name="generator" content={Astro.generator} />
		<title>Gimpaco</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

    <PwaComponent />

    <style>
      body {
        /* The default state should be visible */
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
      }
      /* Style for when we are transitioning pages */
      ::view-transition-old(root) {
        animation: fade-out 0.3s ease-in-out both;
      }
      ::view-transition-new(root) {
        animation: fade-in 0.3s ease-in-out both;
      }
      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes fade-out {
        from { opacity: 1; }
        to { opacity: 0; }
      }
    </style>
    <ViewTransitions fallback="animate" />
	</head>
	<body>
    <!-- La Navbar solo se muestra si la pÃ¡gina no es la de login -->
    {Astro.url.pathname !== '/loginPage' && <Navbar />}
		<slot />

    <script>
      // We are leaving the auth logic commented out for now to ease testing.
      // We can restore this functionality later.

      // import { onAuthStateChanged } from "firebase/auth";
      // import { auth } from "../firebase/config";

      // function handleAuth() {
      //   const currentPath = window.location.pathname;
      //   const isAuthPage = currentPath === '/loginPage';

      //   const unsubscribe = onAuthStateChanged(auth, (user) => {
      //     if (user) {
      //       if (isAuthPage) {
      //         window.location.href = '/';
      //       }
      //     } else {
      //       if (!isAuthPage) {
      //         window.location.href = '/loginPage';
      //       }
      //     }
      //     unsubscribe(); // We only need this to run once per auth state change
      //   });
      // }

      // // Run auth logic on initial page load
      // handleAuth();
      
      // // Re-run auth logic on subsequent page loads (for View Transitions)
      // document.addEventListener('astro:page-load', handleAuth);
    </script>
	</body>
</html>
